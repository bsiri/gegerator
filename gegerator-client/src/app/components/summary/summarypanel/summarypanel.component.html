
<div class="summary-panel">

  <mat-tab-group [dynamicHeight]="true">

    <mat-tab label="Roadmap">
      <div class="pane">
        <h1>Roadmap :</h1>
        <div class="pane-content">
          @for (day of Days.enumerate(); track day) {
            <div>
              <ul>
                @for (event of roadmap.dailyPlanning().get(day); track event) {
                  <li>
                    <app-event-link [event]="event">
                      {{event.toString()}}
                    </app-event-link>
                  </li>
                }
                @if (roadmap.dailyPlanning().get(day)?.length == 0) {
                  <li>
                    <span>{{'('+day.name+' : Rien)'}}</span>
                  </li>
                }
              </ul>
            </div>
          }
        </div>
      </div>
    </mat-tab>

    <mat-tab label="Films">
      <div class="pane">
        <h1>Récap des films :</h1>
        <div class="pane-content">
          <table>
            <tbody>
              @for (movie of movies$ | async | orderByComparable:'rating':'title'; track movie) {
                <tr>
                  <td><app-movie-ratings [rating]="movie.rating"></app-movie-ratings></td>
                  <td>
                    <span>{{movie.title}} </span>
                    <ng-container [ngTemplateOutlet]="movieSessionLink"
                      [ngTemplateOutletContext]="{session:getSession(movie)}">
                    </ng-container>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </mat-tab>

    <mat-tab label="Evenements">
      <div class="pane">
        <h1>Récap des événements :</h1>
        <div class="pane-content">
          <table>
            <tbody>
              @for (event of events$ | async | orderByComparable:'rating':'day':'startTime'; track event) {
                <tr>
                  <td><app-session-ratings [rating]="event.rating"></app-session-ratings></td>
                  <td>
                    <app-event-link [event]="event">{{event.toString()}}</app-event-link>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </mat-tab>


  </mat-tab-group>

</div>

<!-- Templates -->

<ng-template #movieSessionLink  let-session="session">
  @if (session) {
    <app-event-link [event]="session">
      {{session.format('(%d, %h, %t)')}}
    </app-event-link>
  }
  @if (! session) {
    <span>(non planifié)</span>
  }
</ng-template>
